---
title: "Final Project-Group 10"
author: "Luke Richard, Carter Parks, Carter Wolf, Amanda Ohmer"
date: "2024-03-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**National Vehicle Crash Data**


This data set shows the national crash data for motor vehicles from NHTSA. Each crash recorded has many columns of data, keyed to the "Fatality Analysis Report User Manual". We will first clean the data by picking a specific state to explore, in order to better relate traffic and set belt laws to the data. We expect seatbelt laws to decrease fatal crashes by percentage, but this will be the main purpose of the study.

We intend to study the effects of seatbelt use in Iowa compared to traffic fatalities and traffic laws.

```{r}
library(dplyr)
over_time <- read.csv("./75-20_Data.csv")

library(ggplot2)

#Entries Per Year
ggplot(data = over_time, aes(x = factor(YEAR))) + 
  geom_bar() +
  labs(title = 'Entries per Year', x = 'Year', y = 'Number of Entries') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Entries per year remained somewhat consistent, with around 60,000 crashes recorded each year. However there was a considerable dip in entries for 2010 and the following years.

```{r}
#Fatality Rate By Year
finalData <- filter(over_time, `OCUPANTS` != 99 & `OCUPANTS` != 98)
finalData$FATALRATE <- (finalData$DEATHS/finalData$OCUPANTS)
#filter(finalData, FATALRATE < 10)
fatalfinal <- aggregate(FATALRATE ~ YEAR, filter(finalData, FATALRATE < 10), mean)

fatalfinal$YEAR <- as.numeric(as.character(fatalfinal$YEAR))
fatalfinal$FATALRATE <- as.numeric(as.character(fatalfinal$FATALRATE))

  #With linear model
ggplot(data = fatalfinal, aes(x = YEAR, y = FATALRATE)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = 'Fatality Rate per Year', x = 'Year', y = 'Fatality Rate') +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

  #No model
ggplot(data = fatalfinal, aes(x = factor(YEAR), y = factor(FATALRATE))) +
  geom_point() +
  labs(title = 'Fatality Rate per Year', x = 'Year', y = 'Fatality Rate') +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

As we can see, fatality rate seems to have increased slightly over the last 50 years. However it's important to recognize the scale of the y axis, which indicates this is a marginal change.

```{r}
#Fatality Rate per Model Year of Vehicle
modelfinal <- finalData %>% aggregate(FATALRATE ~ MOD_YEAR, mean) %>% filter(MOD_YEAR > 1922 & MOD_YEAR < 2023)

every_nth = function(n) {
  return(function(x) {x[c(TRUE, rep(FALSE, n - 1))]})
}

ggplot(data = modelfinal, aes(x = factor(MOD_YEAR), y = factor(FATALRATE))) + 
  geom_point() +
  labs(title = 'Fatality Rate per Model Year of Vehicle', x = 'Year', y = 'Fatality Rate') +
  scale_y_discrete(breaks=seq(0,1)) +
  scale_x_discrete(breaks = every_nth(n = 5)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1.1, size = 10))

```

This is one of the more interesting graphs we have. Vehicles made before 1975 have considerably higher fatality rates compared to modern vehicles. You can also notice a gradual reduction in fatality rate for vehicles made between 1980 and 2020
```{r}
#Entries by Death per Crash
ggplot(data = over_time, aes(x = factor(YEAR), fill = factor(DEATHS))) + 
  geom_bar() +
  labs(title = 'Entries per Year by Deaths per Crash', x = 'Year', y = 'Number of Crashes', fill = 'Number of Deaths') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Entries by State
ggplot(data = over_time, aes(x = factor(STATE))) + 
  geom_bar() +
  labs(title = 'Entries per Year per State', x = 'State', y = 'Number of Crashes') +
  theme(axis.text.x = element_text(hjust = 1))

#New York Graphs

newyorkfinal <-  aggregate(FATALRATE ~ YEAR, filter(filter(finalData, `STATE` == 36), FATALRATE < 10), mean)

  #New York per year by deaths per crash
ggplot(data = filter(finalData, `STATE` == 36), aes(x = factor(YEAR), fill = factor(DEATHS))) + 
  geom_bar() +
  labs(title = 'Entries per Year by Deaths per Crash', x = 'Year', y = 'Number of Crashes', fill = 'Number of Deaths') +
  theme(axis.text.x = element_text(hjust = 1))

  #New York over time
ggplot(data = newyorkfinal, aes(x = factor(YEAR), y=factor(FATALRATE))) + 
  geom_point(show.legend = FALSE) +
  labs(title = 'New York Fatality Rate by Year', x = 'Year', y = 'Fatality Rate') +
  theme(axis.text.x = element_text(hjust = 1))

#How deformed was vehicle
ggplot(data = filter(finalData, `DEFORMED` != 9), aes(x = factor(DEFORMED), fill = factor(DEATHS))) + 
  geom_bar() +
  labs(title = 'Deaths per crash vs. Deformation Amount', x = 'Deformation Amount', y = 'Number of Crashes') +
  theme(axis.text.x = element_text(hjust = 1))

#Driver Drinking
aggregate(FATALRATE ~ DR_DRINK,filter(finalData, `DR_DRINK` !=9 & `FATALRATE` < 10), mean)

#Driver restrictions
aggregate(FATALRATE ~ L_RESTRI,filter(finalData, `L_RESTRI`<4), mean)

#Speeding
speed <- aggregate(FATALRATE ~ TRAV_SP,filter(finalData, `TRAV_SP` < 152 & `TRAV_SP` > -1), mean)

ggplot(data = speed, aes(x = factor(TRAV_SP), y = factor(FATALRATE))) +
  geom_point() +
  scale_y_discrete(breaks=seq(0,1)) +
  scale_x_discrete(breaks = every_nth(n = 5)) +
  labs(title = 'Fatality Rate vs. Travel Speed', x = 'Speed (MPH)', y = 'Fatality Rate') +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Towing Vehicle
aggregate(FATALRATE ~ TOW_VEH,filter(finalData, `TOW_VEH`<7), mean)

#Vehicle Body Type
body <- aggregate(FATALRATE ~ BODY_TYP,filter(finalData, `BODY_TYP`<99), mean)

ggplot(data = filter(body, `FATALRATE` > .5), aes(x = factor(BODY_TYP), y = factor(FATALRATE))) +
  geom_point() +
  scale_y_discrete(breaks=seq(0,1)) +
  scale_x_discrete(breaks = every_nth(n = 5)) +
  labs(title = 'Fatality Rate per Year', x = 'Year', y = 'Fatality Rate') +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

ggplot(data = filter(body, `BODY_TYP` == 4 | `BODY_TYP` == 14 | `BODY_TYP` == 31 | `BODY_TYP` == 50 | `BODY_TYP` == 66 | `BODY_TYP` == 80), aes(x = factor(BODY_TYP), y = factor(FATALRATE))) +
  geom_point() +
  labs(title = 'Fatality Rate per Body Type', x = 'Body Type', y = 'Fatality Rate')

year_groups <- over_time 
year_groups$COLOR_GROUP <- cut(year_groups$MODEL, breaks = seq(1960, 2020, by = 10), labels = FALSE)

# Manually specify the labels for color groups
color_labels <- as.character(seq(1960, 2020, by = 10))

ggplot(year_groups, aes(x = factor(YEAR), fill = factor(COLOR_GROUP))) +
  geom_bar() +
  scale_fill_brewer(palette = "Set3", labels = color_labels) +  # Specify labels
  labs(title = "Car Crashes by Year Colored by Vehicle Model Year in Chunks of 10 Years",
       x = "Year",
       y = "Number of Car Crashes") +
  theme_minimal()
```

Link To Data: https://www.nhtsa.gov/file-downloads?p=nhtsa/downloads/FARS/



